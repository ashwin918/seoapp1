<% const title='Dashboard' ; const active='dashboard' ; %>
    <%- include('../partials/head') %>
        <%- include('../partials/navbar') %>

            <div class="layout">
                <%- include('../partials/sidebar') %>

                    <main class="main-content">
                        <div class="page-header">
                            <h1 class="page-title">Dashboard</h1>
                            <p class="page-desc">Welcome back, <%= user.name %>
                            </p>
                        </div>

                        <%- include('../partials/flash') %>

                            <!-- Stats -->
                            <div class="stats-row">
                                <div class="stat-box">
                                    <div class="stat-label">Websites</div>
                                    <div class="stat-value">
                                        <%= stats.websites %>
                                    </div>
                                </div>

                                <div class="stat-box">
                                    <div class="stat-label">Avg Score</div>
                                    <div class="stat-value">
                                        <%= stats.avgScore %>
                                    </div>
                                </div>

                                <div class="stat-box">
                                    <div class="stat-label">Analyses</div>
                                    <div class="stat-value">
                                        <%= stats.totalAnalyses %>
                                    </div>
                                </div>

                                <div class="stat-box">
                                    <div class="stat-label">Connections</div>
                                    <div class="stat-value">
                                        <%= stats.connectedAccounts %>
                                    </div>
                                </div>
                            </div>

                            <div class="grid-2">
                                <!-- Recent Analyses -->
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Recent Analyses</h3>
                                        <a href="/analyze/history/all" class="btn btn-ghost btn-sm">View all</a>
                                    </div>
                                    <div class="card-body">
                                        <% if (recentAnalyses.length===0) { %>
                                            <div class="empty-state">
                                                <div class="empty-icon"><i class="fas fa-search"></i></div>
                                                <p class="empty-title">No analyses yet</p>
                                                <a href="/analyze" class="btn btn-primary btn-sm mt-3">Analyze a URL</a>
                                            </div>
                                            <% } else { %>
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>URL</th>
                                                            <th>Score</th>
                                                            <th>Date</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <% recentAnalyses.forEach(function(a) { %>
                                                            <tr>
                                                                <td><a href="/analyze/<%= a.id %>">
                                                                        <%= a.url.substring(0, 35) %>
                                                                            <%= a.url.length> 35 ? '...' : '' %>
                                                                    </a></td>
                                                                <td><span
                                                                        class="badge <%= a.overall_score >= 70 ? 'badge-green' : a.overall_score >= 50 ? 'badge-yellow' : 'badge-red' %>">
                                                                        <%= a.overall_score %>%
                                                                    </span></td>
                                                                <td class="text-muted">
                                                                    <%= new Date(a.analyzed_at).toLocaleDateString() %>
                                                                </td>
                                                            </tr>
                                                            <% }); %>
                                                    </tbody>
                                                </table>
                                                <% } %>
                                    </div>
                                </div>

                                <!-- Connections -->
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Connections</h3>
                                        <a href="/oauth" class="btn btn-ghost btn-sm">Manage</a>
                                    </div>
                                    <div class="card-body">
                                        <% if (connectedAccounts.length===0) { %>
                                            <div class="empty-state">
                                                <div class="empty-icon"><i class="fas fa-plug"></i></div>
                                                <p class="empty-title">No connections</p>
                                                <a href="/oauth" class="btn btn-primary btn-sm mt-3">Connect a
                                                    platform</a>
                                            </div>
                                            <% } else { %>
                                                <% connectedAccounts.forEach(function(acc) { %>
                                                    <div
                                                        style="display: flex; align-items: center; gap: 12px; padding: 10px; border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: 8px;">
                                                        <i class="fab fa-<%= acc.provider %>"
                                                            style="font-size: 1.2rem; width: 24px;"></i>
                                                        <div style="flex: 1;">
                                                            <div style="font-weight: 500; font-size: 0.9rem;">
                                                                <%= acc.account_name %>
                                                            </div>
                                                            <div class="text-muted" style="font-size: 0.8rem;">
                                                                <%= acc.provider %>
                                                            </div>
                                                        </div>
                                                        <span class="badge badge-green">Connected</span>
                                                    </div>
                                                    <% }); %>
                                                        <% } %>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Actions -->
                            <div class="card mt-4">
                                <div class="card-header">
                                    <h3 class="card-title">Quick Actions</h3>
                                </div>
                                <div class="card-body">
                                    <div style="display: flex; gap: 12px;">
                                        <a href="/analyze" class="btn btn-primary"><i class="fas fa-search"></i> Analyze
                                            URL</a>
                                        <a href="/websites/add" class="btn btn-secondary"><i class="fas fa-plus"></i>
                                            Add Website</a>
                                        <a href="/oauth" class="btn btn-secondary"><i class="fas fa-plug"></i> Connect
                                            Platform</a>
                                    </div>
                                </div>
                            </div>
                    </main>
            </div>

            <%- include('../partials/footer') %>