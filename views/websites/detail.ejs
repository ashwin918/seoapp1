<% const title=website.name; const active='websites' ; %>
    <%- include('../partials/head') %>
        <%- include('../partials/navbar') %>

            <div class="layout">
                <%- include('../partials/sidebar') %>

                    <main class="main-content">
                        <div class="page-header"
                            style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h1 class="page-title">
                                    <%= website.name %>
                                </h1>
                                <p class="page-description">
                                    <a href="<%= website.url %>" target="_blank">
                                        <%= website.url %>
                                            <i class="fas fa-external-link-alt"></i>
                                    </a>
                                </p>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <form action="/analyze" method="POST">
                                    <input type="hidden" name="url" value="<%= website.url %>">
                                    <input type="hidden" name="websiteId" value="<%= website.id %>">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-search"></i>
                                        Analyze Now
                                    </button>
                                </form>
                                <a href="/seo/edit/<%= website.id %>" class="btn btn-secondary">
                                    <i class="fas fa-edit"></i>
                                    Edit SEO
                                </a>
                            </div>
                        </div>

                        <%- include('../partials/flash') %>

                            <!-- Website Info -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h3 class="card-title">Website Information</h3>
                                </div>
                                <div class="card-body">
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 2rem;">
                                        <div>
                                            <div class="text-muted" style="font-size: 0.875rem;">Platform</div>
                                            <div style="font-weight: 600;">
                                                <%= website.platform || 'Not specified' %>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="text-muted" style="font-size: 0.875rem;">Connected Account</div>
                                            <div style="font-weight: 600;">
                                                <% if (website.provider) { %>
                                                    <i class="fab fa-<%= website.provider %>"></i>
                                                    <%= website.account_name %>
                                                        <% } else { %>
                                                            Not connected
                                                            <% } %>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="text-muted" style="font-size: 0.875rem;">Added On</div>
                                            <div style="font-weight: 600;">
                                                <%= new Date(website.created_at).toLocaleDateString() %>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="text-muted" style="font-size: 0.875rem;">Last Analyzed</div>
                                            <div style="font-weight: 600;">
                                                <%= website.last_analyzed ? new
                                                    Date(website.last_analyzed).toLocaleDateString() : 'Never' %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Analyses -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h3 class="card-title">Recent Analyses</h3>
                                </div>
                                <div class="card-body">
                                    <% if (analyses.length===0) { %>
                                        <div class="empty-state" style="padding: 2rem;">
                                            <div class="empty-icon">
                                                <i class="fas fa-search"></i>
                                            </div>
                                            <p class="empty-title">No analyses yet</p>
                                            <p class="empty-description">Run an analysis to see results here.</p>
                                        </div>
                                        <% } else { %>
                                            <div class="table-responsive">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Score</th>
                                                            <th>Title</th>
                                                            <th>Meta</th>
                                                            <th>Content</th>
                                                            <th>Technical</th>
                                                            <th>Date</th>
                                                            <th>Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <% analyses.forEach(function(analysis) { %>
                                                            <tr>
                                                                <td>
                                                                    <span
                                                                        class="badge <%= analysis.overall_score >= 80 ? 'badge-success' : analysis.overall_score >= 60 ? 'badge-warning' : 'badge-danger' %>">
                                                                        <%= analysis.overall_score %>%
                                                                    </span>
                                                                </td>
                                                                <td>
                                                                    <%= analysis.title_score %>%
                                                                </td>
                                                                <td>
                                                                    <%= analysis.meta_score %>%
                                                                </td>
                                                                <td>
                                                                    <%= analysis.content_score %>%
                                                                </td>
                                                                <td>
                                                                    <%= analysis.technical_score %>%
                                                                </td>
                                                                <td class="text-muted">
                                                                    <%= new
                                                                        Date(analysis.analyzed_at).toLocaleDateString()
                                                                        %>
                                                                </td>
                                                                <td>
                                                                    <a href="/analyze/<%= analysis.id %>"
                                                                        class="btn btn-secondary btn-sm">
                                                                        <i class="fas fa-eye"></i>
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                            <% }); %>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <% } %>
                                </div>
                            </div>

                            <!-- Recent Edits -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h3 class="card-title">Recent SEO Edits</h3>
                                    <a href="/seo/history/<%= website.id %>" class="btn btn-secondary btn-sm">View
                                        All</a>
                                </div>
                                <div class="card-body">
                                    <% if (edits.length===0) { %>
                                        <div class="empty-state" style="padding: 2rem;">
                                            <div class="empty-icon">
                                                <i class="fas fa-edit"></i>
                                            </div>
                                            <p class="empty-title">No edits yet</p>
                                            <p class="empty-description">Make SEO changes to see them here.</p>
                                        </div>
                                        <% } else { %>
                                            <div class="table-responsive">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Field</th>
                                                            <th>Status</th>
                                                            <th>Date</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <% edits.forEach(function(edit) { %>
                                                            <tr>
                                                                <td>
                                                                    <%= edit.field_type %>
                                                                </td>
                                                                <td>
                                                                    <span
                                                                        class="badge <%= edit.status === 'applied' ? 'badge-success' : edit.status === 'pending' ? 'badge-warning' : 'badge-neutral' %>">
                                                                        <%= edit.status %>
                                                                    </span>
                                                                </td>
                                                                <td class="text-muted">
                                                                    <%= new Date(edit.created_at).toLocaleDateString()
                                                                        %>
                                                                </td>
                                                            </tr>
                                                            <% }); %>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <% } %>
                                </div>
                            </div>

                            <!-- Danger Zone -->
                            <div class="card" style="border-color: rgba(239, 68, 68, 0.3);">
                                <div class="card-header">
                                    <h3 class="card-title" style="color: var(--danger);">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Danger Zone
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="font-weight: 600;">Delete this website</div>
                                            <div class="text-muted">Once deleted, all data associated with this website
                                                will be permanently removed.</div>
                                        </div>
                                        <form action="/websites/<%= website.id %>/delete" method="POST"
                                            onsubmit="return confirm('Are you sure you want to delete this website? This action cannot be undone.');">
                                            <button type="submit" class="btn btn-danger">
                                                <i class="fas fa-trash"></i>
                                                Delete Website
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                    </main>
            </div>

            <%- include('../partials/footer') %>