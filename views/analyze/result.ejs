<% const title='Analysis Result' ; const active='analyze' ; %>
    <%- include('../partials/head') %>
        <%- include('../partials/navbar') %>

            <div class="layout">
                <%- include('../partials/sidebar') %>

                    <main class="main-content">
                        <div class="page-header mb-4"
                            style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h1 class="page-title">Digital Audit Report</h1>
                                <p class="text-muted"><i class="fas fa-link" style="margin-right: 8px;"></i>
                                    <%= analysis.url %>
                                </p>
                            </div>
                            <a href="/analyze" class="btn btn-secondary btn-sm"><i class="fas fa-plus"></i> New
                                Audit</a>
                        </div>

                        <div class="grid-3 mb-4" style="grid-template-columns: 1fr 2fr;">
                            <!-- Overal Score -->
                            <div class="card">
                                <div class="card-body text-center">
                                    <div
                                        class="score-circle <%= scores.overall >= 70 ? 'good' : scores.overall >= 50 ? 'ok' : 'bad' %>">
                                        <span class="score-number">
                                            <%= scores.overall %>
                                        </span>
                                        <span class="score-label">Global Score</span>
                                    </div>
                                    <div class="badge <%= scores.overall >= 70 ? 'badge-green' : scores.overall >= 50 ? 'badge-yellow' : 'badge-red' %>"
                                        style="padding: 10px 24px; font-size: 1rem;">
                                        Performance Level: <%= grade %>
                                    </div>
                                </div>
                            </div>

                            <!-- Detailed Metrics -->
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Metric Breakdown</h3>
                                </div>
                                <div class="card-body">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 32px;">
                                        <% [ { name: 'Title Optimization' , score: scores.title, icon: 'heading' }, {
                                            name: 'Meta Compliance' , score: scores.meta, icon: 'tags' }, {
                                            name: 'Content Depth' , score: scores.content, icon: 'file-alt' }, {
                                            name: 'Technical Validity' , score: scores.technical, icon: 'code' }, {
                                            name: 'Loading Speed' , score: scores.performance, icon: 'bolt' }
                                            ].forEach(function(item) { %>
                                            <div class="metric-item">
                                                <div
                                                    style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                                    <span style="font-weight: 600; font-size: 0.9rem;"><i
                                                            class="fas fa-<%= item.icon %>"
                                                            style="margin-right: 8px; color: var(--primary);"></i>
                                                        <%= item.name %>
                                                    </span>
                                                    <span
                                                        style="font-weight: 800; color: <%= item.score >= 70 ? 'var(--success)' : item.score >= 50 ? 'var(--warning)' : 'var(--danger)' %>;">
                                                        <%= item.score %>%
                                                    </span>
                                                </div>
                                                <div
                                                    style="height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden;">
                                                    <div
                                                        style="height: 100%; width: <%= item.score %>%; background: <%= item.score >= 70 ? 'var(--success)' : item.score >= 50 ? 'var(--warning)' : 'var(--danger)' %>; border-radius: 3px; transition: width 1s ease-out;">
                                                    </div>
                                                </div>
                                            </div>
                                            <% }); %>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Findings -->
                        <div class="grid-2 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="fas fa-bug text-red"></i> Critical Findings</h3>
                                    <span class="badge badge-red">
                                        <%= issues.length %> issues
                                    </span>
                                </div>
                                <div class="card-body" style="padding: 0;">
                                    <% if (issues.length===0) { %>
                                        <div class="text-center" style="padding: 40px;">
                                            <i class="fas fa-check-circle text-green mb-3" style="font-size: 2rem;"></i>
                                            <p class="text-muted">No security or structure issues detected.</p>
                                        </div>
                                        <% } else { %>
                                            <div style="display: flex; flex-direction: column;">
                                                <% issues.forEach(function(issue) { %>
                                                    <div
                                                        style="padding: 20px 32px; border-bottom: 1px solid var(--border); display: flex; gap: 16px;">
                                                        <i class="fas fa-exclamation-triangle"
                                                            style="color: <%= issue.type === 'critical' ? 'var(--danger)' : 'var(--warning)' %>; margin-top: 4px;"></i>
                                                        <div>
                                                            <div
                                                                style="font-weight: 600; font-size: 0.95rem; margin-bottom: 4px;">
                                                                <%= issue.message %>
                                                            </div>
                                                            <span class="badge badge-gray" style="font-size: 0.7rem;">
                                                                <%= issue.category %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <% }); %>
                                            </div>
                                            <% } %>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="fas fa-lightbulb text-yellow"></i> Optimization
                                        Roadmap</h3>
                                </div>
                                <div class="card-body" style="padding: 0;">
                                    <% if (suggestions.length===0) { %>
                                        <div class="text-center" style="padding: 40px;">
                                            <i class="fas fa-star text-yellow mb-3" style="font-size: 2rem;"></i>
                                            <p class="text-muted">Your optimization is at baseline excellence.</p>
                                        </div>
                                        <% } else { %>
                                            <div style="display: flex; flex-direction: column;">
                                                <% suggestions.forEach(function(s) { %>
                                                    <div
                                                        style="padding: 20px 32px; border-bottom: 1px solid var(--border); display: flex; gap: 16px;">
                                                        <div
                                                            style="width: 24px; height: 24px; border-radius: 50%; background: var(--warning-bg); color: var(--warning); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                                            <i class="fas fa-plus" style="font-size: 0.7rem;"></i>
                                                        </div>
                                                        <div>
                                                            <div style="font-size: 0.95rem; margin-bottom: 4px;">
                                                                <%= s.suggestion %>
                                                            </div>
                                                            <span class="badge badge-gray" style="font-size: 0.7rem;">
                                                                <%= s.category %>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <% }); %>
                                            </div>
                                            <% } %>
                                </div>
                            </div>
                        </div>

                        <!-- Raw Data -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title"><i class="fas fa-database"></i> Technical Metadata</h3>
                            </div>
                            <div class="card-body">
                                <div class="table-container">
                                    <table class="table">
                                        <tbody>
                                            <tr>
                                                <td style="width: 200px; font-weight: 700;">Page Title</td>
                                                <td>
                                                    <%= seoData.title || 'Not Detected' %> <span
                                                            class="badge badge-gray" style="margin-left: 8px;">
                                                            <%= (seoData.title || '' ).length %> chars
                                                        </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="font-weight: 700;">Meta Description</td>
                                                <td>
                                                    <%= seoData.metaDescription || 'Not Detected' %> <span
                                                            class="badge badge-gray" style="margin-left: 8px;">
                                                            <%= (seoData.metaDescription || '' ).length %> chars
                                                        </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="font-weight: 700;">H1 Architecture</td>
                                                <td>
                                                    <% if (seoData.h1Tags && seoData.h1Tags.length> 0) { %>
                                                        <div style="display: flex; flex-direction: column; gap: 4px;">
                                                            <% seoData.h1Tags.forEach(function(h1) { %>
                                                                <div
                                                                    style="font-family: monospace; font-size: 0.85rem; color: var(--primary);">
                                                                    <%= h1 %>
                                                                </div>
                                                                <% }); %>
                                                        </div>
                                                        <% } else { %>
                                                            <span class="text-red">Missing H1 Heading</span>
                                                            <% } %>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style="font-weight: 700;">Performance Stats</td>
                                                <td>
                                                    <div style="display: flex; gap: 24px;">
                                                        <span><i class="fas fa-clock" style="margin-right: 4px;"></i>
                                                            Load: <%= seoData.loadTime.toFixed(2) %>s</span>
                                                        <span><i class="fas fa-file-word"
                                                                style="margin-right: 4px;"></i> Content: <%=
                                                                seoData.wordCount %> words</span>
                                                        <span><i class="fas fa-image" style="margin-right: 4px;"></i>
                                                            Media: <%= seoData.totalImages %> items</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </main>
            </div>

            <%- include('../partials/footer') %>