<% const title='Audit Logs' ; const active='history' ; %>
    <%- include('../partials/head') %>
        <%- include('../partials/navbar') %>

            <div class="layout">
                <%- include('../partials/sidebar') %>

                    <main class="main-content">
                        <div class="page-header mb-4"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h1 class="page-title">Intelligence Logs</h1>
                                <p class="text-muted">History of all agent-driven audits across your ecosystem.</p>
                            </div>
                            <a href="/analyze" class="btn btn-primary">
                                <i class="fas fa-radar"></i> New Audit
                            </a>
                        </div>

                        <%- include('../partials/flash') %>

                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title"><i class="fas fa-history" style="color: var(--primary);"></i>
                                        Audit Archive</h3>
                                </div>
                                <div class="card-body" style="padding: 0;">
                                    <% if (analyses.length===0) { %>
                                        <div class="text-center" style="padding: 100px 40px;">
                                            <i class="fas fa-clipboard-list mb-3"
                                                style="font-size: 3.5rem; opacity: 0.1;"></i>
                                            <h2>Archive is Empty</h2>
                                            <p class="text-muted mb-4">No audit logs have been generated yet. Deploy an
                                                agent to start tracking SEO performance.</p>
                                            <a href="/analyze" class="btn btn-primary btn-lg">Deploy Agent</a>
                                        </div>
                                        <% } else { %>
                                            <div class="table-container" style="border: none;">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>Target URL</th>
                                                            <th>Overall</th>
                                                            <th>Structure</th>
                                                            <th>Content</th>
                                                            <th>Technical</th>
                                                            <th>Timestamp</th>
                                                            <th class="text-right">Actions</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <% analyses.forEach(function(a) { %>
                                                            <tr>
                                                                <td>
                                                                    <div
                                                                        style="display: flex; align-items: center; gap: 12px;">
                                                                        <div class="brand-icon"
                                                                            style="width: 32px; height: 32px; border-radius: 8px; font-size: 0.9rem;">
                                                                            <i class="fas fa-globe"></i>
                                                                        </div>
                                                                        <span style="font-weight: 600;">
                                                                            <%= a.url.replace(/^https?:\/\//, ''
                                                                                ).substring(0, 30) %>
                                                                                <%= a.url.length> 30 ? '...' : '' %>
                                                                        </span>
                                                                    </div>
                                                                </td>
                                                                <td>
                                                                    <span
                                                                        class="badge <%= a.overall_score >= 80 ? 'badge-green' : a.overall_score >= 50 ? 'badge-yellow' : 'badge-red' %>">
                                                                        <%= a.overall_score %>%
                                                                    </span>
                                                                </td>
                                                                <td>
                                                                    <%= a.title_score %>%
                                                                </td>
                                                                <td>
                                                                    <%= a.content_score %>%
                                                                </td>
                                                                <td>
                                                                    <%= a.technical_score %>%
                                                                </td>
                                                                <td class="text-muted">
                                                                    <%= new
                                                                        Date(a.analyzed_at).toLocaleDateString('en-US',
                                                                        { month: 'short' , day: 'numeric' ,
                                                                        year: 'numeric' }) %>
                                                                </td>
                                                                <td class="text-right">
                                                                    <a href="/analyze/<%= a.id %>"
                                                                        class="btn btn-secondary btn-sm">Report</a>
                                                                </td>
                                                            </tr>
                                                            <% }); %>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <% } %>
                                </div>
                            </div>
                    </main>
            </div>

            <%- include('../partials/footer') %>